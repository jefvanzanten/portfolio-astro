---
import CommitCard from "./CommitCard.astro";
import { fetchLatestCommitsViaEvents } from "../../lib/github";

const GITHUB_USERNAME = "jefvanzanten";

// Fetch commits at build time via Events API (hybrid approach)
// Uses GITHUB_TOKEN env var if available for higher rate limits
const commits = await fetchLatestCommitsViaEvents(
  GITHUB_USERNAME,
  10,
  import.meta.env.GITHUB_TOKEN,
);
---

{
  commits.length > 0 && (
    <section class="commits-section">
      <div class="title">
        <span class="line" />
        <h1>Recente Activiteit</h1>
        <span class="line" />
      </div>
      <div class="commits-scroll-container">
        <div class="commits-track">
          {commits.map((commit) => (
            <CommitCard commit={commit} />
          ))}
        </div>
      </div>
    </section>
  )
}

<style>
  .commits-section {
    display: flex;
    flex-direction: column;
    gap: 1.5em;
    overflow: hidden;
    width: var(--featured-projects-container-width);

    @media screen and (max-width: 940px) {
      display: none;
    }
  }

  .commits-scroll-container {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    padding: 1em 0;

    .commits-track {
      display: flex;
      gap: 1em;
      padding: 0.5em;
      width: max-content;
    }
  }
</style>
